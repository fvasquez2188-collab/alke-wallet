<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wallet | Depositar</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style_propio.css">
</head>

<body>
<main class="container py-4 page-center">
  <section class="row justify-content-center w-100">
    <section class="col-12 col-md-6">

      <section class="card shadow">
        <section class="card-body">

          <h2 class="text-center mb-3">Depositar dinero</h2>

          <section class="text-center text-muted mb-3">
            Saldo actual:
            <strong id="saldoActual">$0</strong>
          </section>

          <section class="mb-3">
            <input type="number" id="amount" class="form-control"
                   placeholder="Monto a depositar">
          </section>

          <button id="depositBtn" class="btn btn-primary w-100">
            Depositar
          </button>

          <section id="depositResult" class="mt-3 text-center"></section>

          <button id="btnVolver" class="btn btn-outline-secondary w-100 mt-2">
            Volver al menú
          </button>

        </section>
      </section>

    </section>
  </section>
</main>

<!-- MODAL CONFIRMACIÓN -->
<div class="modal fade" id="confirmModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirmación</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center" id="confirmMessage"></div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button class="btn btn-primary" id="confirmActionBtn">Confirmar</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ===============================
   ELEMENTOS
=============================== */
const amountInput = document.getElementById("amount");
const saldoTxt = document.getElementById("saldoActual");
const resultBox = document.getElementById("depositResult");

/* ===============================
   SALDO (COMPATIBLE)
=============================== */
let saldo =
  Number(sessionStorage.getItem("saldo")) ||
  Number(localStorage.getItem("saldo")) ||
  0;

saldoTxt.textContent = `$${saldo.toLocaleString()}`;

/* ===============================
   MODAL CONFIRMACIÓN
=============================== */
const confirmModal = new bootstrap.Modal(document.getElementById("confirmModal"));
let accionConfirmada = null;

function mostrarConfirmacion(msg, accion) {
  document.getElementById("confirmMessage").textContent = msg;
  accionConfirmada = accion;
  confirmModal.show();
}

document.getElementById("confirmActionBtn").onclick = () => {
  confirmModal.hide();
  if (accionConfirmada) accionConfirmada();
};

/* ===============================
   DEPOSITAR
=============================== */
document.getElementById("depositBtn").onclick = () => {
  const monto = Number(amountInput.value);
  if (monto <= 0) return;

  mostrarConfirmacion(
    `¿Confirmar depósito de $${monto.toLocaleString()}?`,
    () => {
      saldo += monto;

      sessionStorage.setItem("saldo", saldo);
      localStorage.setItem("saldo", saldo);

      guardarMovimiento("Depósito", monto);

      saldoTxt.textContent = `$${saldo.toLocaleString()}`;

      resultBox.innerHTML = `
        <div class="alert alert-success">
          Depósito realizado con éxito.<br>
          Redirigiendo al menú...
        </div>
      `;

      amountInput.value = "";

      // ⏳ REDIRECCIÓN DESPUÉS DE 2 SEGUNDOS
      setTimeout(() => {
        window.location.href = "menu1.html";
      }, 2000);
    }
  );
};

/* ===============================
   VOLVER
=============================== */
document.getElementById("btnVolver").onclick = () =>
  mostrarConfirmacion(
    "¿Deseas volver al menú principal?",
    () => window.location.href = "menu1.html"
  );

/* ===============================
   MOVIMIENTOS
=============================== */
function guardarMovimiento(desc, monto) {
  let t =
    JSON.parse(sessionStorage.getItem("transactions")) ||
    JSON.parse(localStorage.getItem("transactions")) ||
    [];

  t.unshift({ desc, monto, fecha: new Date().toLocaleString() });

  sessionStorage.setItem("transactions", JSON.stringify(t));
  localStorage.setItem("transactions", JSON.stringify(t));
}
</script>
</body>
</html>


